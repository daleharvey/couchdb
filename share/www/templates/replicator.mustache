<script>
  $(document).ready(function() {
    $("fieldset input[type=radio]").click(function() {
      var radio = this;
      var fieldset = $(this).parents("fieldset").get(0);
      $("input[type=text]", fieldset).each(function() {
        this.disabled = radio.value == "local";
        if (!this.disabled) this.focus();
      });
      $("select", fieldset).each(function() {
        this.disabled = radio.value == "remote";
        if (!this.disabled) this.focus();
      });
    });

    $.couch.allDbs({
      success: function(dbs) {
        dbs.sort();
        $("fieldset select").each(function() {
          var select = this;
          $.each(dbs, function(idx, dbName) {
            $("<option></option>").text(dbName).appendTo(select);
          });
          select.selectedIndex = 0;
        });
      }
    });

    $("button#swap").click(function() {
      var fromName = $("#source select").val();
      $("#source select").val($("#target select").val());
      $("#target select").val(fromName);

      var fromUrl = $("#source input[type=text]").val();
      $("#source input[type=text]").val($("#target input[type=text]").val());
      $("#target input[type=text]").val(fromUrl);

      var fromType = $("#source input[type=radio]").filter(function() {
        return this.checked;
      }).val();
      var toType = $("#target input[type=radio]").filter(function() {
        return this.checked;
      }).val();
      $("#source input[value=" + toType + "]").click();
      $("#target input[value=" + fromType + "]").click();

      $("#replicate").get(0).focus();
      return false;
    });

    $("button#replicate").click(function() {
      $("#records tbody.content").empty();
      var source = $("#from_local")[0].checked ? $("#from_name").val() : $("#from_url").val();
      var target = $("#to_local")[0].checked ? $("#to_name").val() : $("#to_url").val();
      var repOpts = {};
      if ($("#continuous")[0].checked) {
        repOpts.continuous = true;
      }
      $.couch.replicate(source, target, {
        success: function(resp) {
          if (resp._local_id) {
            $("<tr><th></th></tr>")
              .find("th").text(JSON.stringify(resp)).end()
              .appendTo("#records tbody.content");
            $("#records tbody tr").removeClass("odd").filter(":odd").addClass("odd");
          } else {
            $.each(resp.history, function(idx, record) {
              $("<tr><th></th></tr>")
                .find("th").text(JSON.stringify(record)).end()
                .appendTo("#records tbody.content");
            });
            $("#records tbody tr").removeClass("odd").filter(":odd").addClass("odd");
            $("#records tbody.footer td").text("Replication session " + resp.session_id);
          }
        }
      }, repOpts);
    });
  });
</script>
<form id="replicator">
  <fieldset id="source">
    <legend>Replicate changes from:</legend>
    <p>
      <input type="radio" id="from_local" name="from_type" value="local" checked> 
      <label for="from_local">Local Database: </label>
      <select id="from_name" name="from_name"></select>
    </p><p>
      <input type="radio" id="from_to_remote" name="from_type" value="remote"> 
      <label for="from_to_remote">Remote database: </label>
      <input type="text" id="from_url" name="from_url" size="30" value="http://" disabled>
    </p>
  </fieldset>
  <p class="swap"><button id="swap" tabindex="99">â‡„</button></p>
  <fieldset id="target">
    <legend>to:</legend>
    <p>
      <input type="radio" id="to_local" name="to_type" value="local" checked> 
      <label for="to_local">Local database: </label>
      <select id="to_name" name="to_name"></select>
    </p><p>
      <input type="radio" id="to_remote" name="to_type" value="remote"> 
      <label for="to_remote">Remote database: </label>
      <input type="text" id="to_url" name="to_url" size="30" value="http://" disabled>
    </p>
  </fieldset>
  <p class="actions">
    <label><input type="checkbox" name="continuous" value="continuous" id="continuous"> Continuous</label>
    <button id="replicate" type="button">Replicate</button>
  </p>
</form>

<table id="records" class="listing" cellspacing="0">
  <caption>Replication History</caption>
  <thead><tr>
    <th>Event</th>
  </tr></thead>
  <tbody class="content"></tbody>
  <tbody class="footer"><tr>
    <td colspan="4">No replication</td>
  </tr></tbody>
</table>